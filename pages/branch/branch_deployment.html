<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deployment ‚Äî Manpower Monitoring System</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --red:#C0392B;--red-bright:#E74C3C;--red-dark:#922B21;
  --red-glow:rgba(192,57,43,0.14);
  --dark:#610e03;--dark2:#2C1410;--dark3:#3D1A15;
  --gray:#8B7B78;--light-gray:#F4EAE8;--cream:#FDF6F0;--white:#FFFFFF;
  --success:#27AE60;--warning:#E67E22;--info:#2980B9;--purple:#8E44AD;
  --teal:#16A085;--orange:#D35400;
  --border:#EDD8D5;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:#F8F0EE;color:var(--dark);min-height:100vh;display:flex;}

/* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
.sidebar{width:240px;min-height:100vh;background:var(--dark);position:fixed;left:0;top:0;bottom:0;z-index:100;border-right:2px solid var(--red-dark);display:flex;flex-direction:column;}
.sidebar-logo{padding:28px 20px 20px;border-bottom:1px solid var(--dark3);}
.logo-badge{display:flex;align-items:center;gap:10px;}
.logo-icon{width:38px;height:38px;background:var(--red);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;}
.logo-text{font-family:'Rajdhani',sans-serif;font-size:17px;font-weight:700;color:var(--white);line-height:1.2;}
.logo-sub{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:1px;}
.branch-tag{margin:14px 20px;background:var(--red-glow);border:1px solid var(--red-dark);border-radius:6px;padding:8px 12px;}
.branch-tag .label{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:1px;}
.branch-tag .value{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;color:var(--red-bright);}
.nav-section{padding:8px 0;flex:1;}
.nav-label{padding:14px 20px 6px;font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:1.5px;}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 20px;color:#A89693;cursor:pointer;transition:all .2s;font-size:14px;font-weight:500;border-left:3px solid transparent;}
.nav-item:hover,.nav-item.active{color:var(--white);background:rgba(192,57,43,.12);border-left-color:var(--red);}
.nav-item.active{color:var(--red-bright);}
.nav-item .icon{width:20px;text-align:center;font-size:16px;}
.nav-badge{margin-left:auto;background:var(--red);color:white;font-size:10px;font-weight:700;padding:2px 7px;border-radius:20px;}
.sidebar-footer{padding:16px 20px;border-top:1px solid var(--dark3);}
.admin-card{display:flex;align-items:center;gap:10px;}
.admin-av{width:36px;height:36px;background:var(--red);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;color:white;flex-shrink:0;}
.admin-info .name{font-size:13px;font-weight:600;color:var(--white);}
.admin-info .role{font-size:11px;color:var(--gray);}
.logout-btn{margin-left:auto;background:none;border:none;color:var(--gray);cursor:pointer;font-size:16px;}
.logout-btn:hover{color:var(--red-bright);}

/* ‚ïê‚ïê MAIN ‚ïê‚ïê */
.main{margin-left:240px;flex:1;display:flex;flex-direction:column;min-height:100vh;}
.topbar{background:var(--white);border-bottom:1px solid #E8D8D5;padding:14px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;box-shadow:0 2px 8px rgba(192,57,43,.06);}
.topbar-left h1{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;letter-spacing:.5px;}
.topbar-left .subtitle{font-size:12px;color:var(--gray);margin-top:1px;}
.topbar-right{display:flex;align-items:center;gap:12px;}
.live-badge{display:flex;align-items:center;gap:6px;background:rgba(39,174,96,.1);color:var(--success);font-size:11px;font-weight:700;padding:6px 12px;border-radius:20px;}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--success);animation:pulse 1.5s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
.notif-btn{position:relative;background:var(--light-gray);border:none;cursor:pointer;width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;}
.notif-btn .nb{position:absolute;top:4px;right:4px;width:8px;height:8px;background:var(--red);border-radius:50%;border:2px solid white;}

/* ‚ïê‚ïê BUTTONS ‚ïê‚ïê */
.btn-primary{background:var(--red);color:white;border:none;padding:9px 18px;border-radius:9px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:background .2s;display:inline-flex;align-items:center;gap:7px;white-space:nowrap;}
.btn-primary:hover{background:var(--red-dark);}
.btn-outline{background:none;color:var(--gray);border:1.5px solid var(--border);padding:8px 14px;border-radius:9px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:7px;white-space:nowrap;}
.btn-outline:hover{border-color:var(--red);color:var(--red);}
.btn-ghost{background:none;border:none;color:var(--gray);padding:5px 9px;border-radius:7px;cursor:pointer;font-size:13px;font-family:'DM Sans',sans-serif;transition:all .2s;}
.btn-ghost:hover{background:var(--light-gray);color:var(--dark);}
.icon-btn{width:30px;height:30px;border-radius:7px;border:1.5px solid var(--border);background:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--gray);transition:all .2s;}
.icon-btn:hover{background:var(--red);color:white;border-color:var(--red);}

/* ‚ïê‚ïê CONTENT ‚ïê‚ïê */
.content{padding:24px 28px;display:flex;flex-direction:column;gap:20px;}

/* ‚ïê‚ïê KPI STRIP ‚ïê‚ïê */
.kpi-strip{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;}
.kpi{background:var(--white);border-radius:12px;border:1px solid var(--border);padding:16px 18px;position:relative;overflow:hidden;animation:fadeUp .4s ease both;transition:all .2s;cursor:default;}
.kpi:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(192,57,43,.09);}
.kpi::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--red);}
.kpi.g::after{background:var(--success);}
.kpi.b::after{background:var(--info);}
.kpi.o::after{background:var(--warning);}
.kpi.p::after{background:var(--purple);}
.kpi:nth-child(1){animation-delay:.00s}.kpi:nth-child(2){animation-delay:.06s}.kpi:nth-child(3){animation-delay:.12s}.kpi:nth-child(4){animation-delay:.18s}.kpi:nth-child(5){animation-delay:.24s}
.kpi-lbl{font-size:10px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.7px;margin-bottom:8px;}
.kpi-val{font-family:'Rajdhani',sans-serif;font-size:30px;font-weight:700;color:var(--dark);line-height:1;}
.kpi-sub{font-size:11px;color:var(--gray);margin-top:4px;}
.kpi-icon{position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:26px;opacity:.12;}

/* ‚ïê‚ïê TWO-COLUMN LAYOUT ‚ïê‚ïê */
.deploy-layout{display:grid;grid-template-columns:1fr 300px;gap:20px;align-items:start;}

/* ‚ïê‚ïê DEPLOYMENT MAP / FLOOR PLAN ‚ïê‚ïê */
.map-card{background:var(--white);border-radius:16px;border:1px solid var(--border);overflow:hidden;animation:fadeUp .4s ease .22s both;}
.map-card-hdr{padding:16px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.map-card-title{font-family:'Rajdhani',sans-serif;font-size:17px;font-weight:700;color:var(--dark);display:flex;align-items:center;gap:8px;}
.map-toolbar{display:flex;gap:8px;align-items:center;}
.view-tabs{display:flex;border:1.5px solid var(--border);border-radius:9px;overflow:hidden;}
.view-tab{padding:7px 14px;font-size:12px;font-weight:600;color:var(--gray);background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;}
.view-tab.active{background:var(--red);color:white;}

/* FLOOR PLAN */
.floor-plan-wrap{padding:24px;background:#F9F0ED;position:relative;min-height:440px;}
.floor-plan{width:100%;max-width:780px;margin:0 auto;position:relative;}

/* ZONES */
.zone{position:absolute;border-radius:12px;border:2px solid;cursor:pointer;transition:all .25s;overflow:hidden;}
.zone:hover{transform:scale(1.02);box-shadow:0 8px 28px rgba(0,0,0,.12);z-index:10;}
.zone-header{padding:8px 12px;display:flex;align-items:center;justify-content:space-between;}
.zone-name{font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;}
.zone-count{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;background:rgba(255,255,255,.35);padding:2px 8px;border-radius:20px;}
.zone-emps{padding:4px 8px 8px;display:flex;flex-wrap:wrap;gap:4px;}
.zone-emp-dot{width:28px;height:28px;border-radius:50%;border:2px solid rgba(255,255,255,.6);display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;color:white;cursor:pointer;transition:transform .15s;flex-shrink:0;}
.zone-emp-dot:hover{transform:scale(1.2);z-index:5;border-color:white;}
.zone-status-bar{height:4px;width:100%;}
.add-to-zone{display:flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:50%;border:2px dashed rgba(255,255,255,.5);color:rgba(255,255,255,.7);font-size:14px;cursor:pointer;transition:all .2s;flex-shrink:0;}
.add-to-zone:hover{border-color:white;color:white;background:rgba(255,255,255,.15);}

/* FLOOR LEGEND */
.floor-legend{display:flex;flex-wrap:wrap;gap:12px;padding:14px 24px;border-top:1px solid var(--border);background:var(--cream);}
.fl-item{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--gray);font-weight:500;}
.fl-dot{width:10px;height:10px;border-radius:3px;flex-shrink:0;}

/* ‚ïê‚ïê RIGHT PANEL ‚ïê‚ïê */
.right-panel{display:flex;flex-direction:column;gap:16px;animation:fadeUp .4s ease .3s both;}

/* EMPLOYEE ROSTER */
.roster-card{background:var(--white);border-radius:14px;border:1px solid var(--border);overflow:hidden;}
.rc-hdr{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.rc-title{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;color:var(--dark);display:flex;align-items:center;gap:7px;}
.rc-search{display:flex;align-items:center;gap:6px;background:var(--light-gray);border:1.5px solid var(--border);border-radius:8px;padding:7px 10px;width:100%;margin:10px 18px;box-sizing:border-box;transition:border-color .2s;}
.rc-search:focus-within{border-color:var(--red);}
.rc-search input{background:none;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:12px;color:var(--dark);width:100%;}
.roster-item{display:flex;align-items:center;gap:10px;padding:10px 18px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;position:relative;}
.roster-item:last-child{border-bottom:none;}
.roster-item:hover{background:var(--cream);}
.roster-item.dragging{opacity:.5;background:rgba(192,57,43,.05);}
.ri-av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:white;flex-shrink:0;position:relative;}
.ri-status{position:absolute;bottom:0;right:0;width:9px;height:9px;border-radius:50%;border:2px solid white;}
.ri-name{font-size:12px;font-weight:600;color:var(--dark);}
.ri-pos{font-size:10px;color:var(--gray);}
.ri-zone{margin-left:auto;font-size:10px;font-weight:600;padding:2px 8px;border-radius:5px;}
.ri-drag{color:var(--gray);font-size:14px;cursor:grab;margin-left:4px;opacity:.5;}

/* STATUS BADGES */
.status-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:5px;}

/* ZONE SUMMARY CARD */
.zone-summary-card{background:var(--white);border-radius:14px;border:1px solid var(--border);overflow:hidden;}
.zs-item{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;}
.zs-item:last-child{border-bottom:none;}
.zs-item:hover{background:var(--cream);}
.zs-left{display:flex;align-items:center;gap:10px;}
.zs-color{width:10px;height:30px;border-radius:4px;flex-shrink:0;}
.zs-name{font-size:13px;font-weight:600;color:var(--dark);}
.zs-req{font-size:11px;color:var(--gray);}
.zs-right{display:flex;align-items:center;gap:8px;}
.zs-count{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;}
.zs-bar-wrap{width:60px;height:6px;background:var(--light-gray);border-radius:3px;overflow:hidden;}
.zs-bar-fill{height:100%;border-radius:3px;transition:width .5s ease;}

/* ALERT CARD */
.alert-card{background:var(--white);border-radius:14px;border:1px solid var(--border);overflow:hidden;}
.alert-item{display:flex;gap:10px;padding:12px 18px;border-bottom:1px solid var(--border);}
.alert-item:last-child{border-bottom:none;}
.alert-icon{font-size:18px;flex-shrink:0;margin-top:1px;}
.alert-title{font-size:12px;font-weight:600;color:var(--dark);}
.alert-sub{font-size:11px;color:var(--gray);margin-top:1px;line-height:1.4;}
.alert-time{font-size:10px;color:var(--gray);margin-top:4px;}

/* ‚ïê‚ïê TABLE VIEW ‚ïê‚ïê */
.table-view{display:none;padding:0;}
.dep-table{width:100%;border-collapse:collapse;}
.dep-table thead th{padding:11px 16px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:var(--gray);text-align:left;background:var(--cream);border-bottom:2px solid var(--border);}
.dep-table tbody tr{border-bottom:1px solid var(--border);transition:background .15s;cursor:pointer;}
.dep-table tbody tr:hover{background:var(--cream);}
.dep-table tbody tr:last-child{border-bottom:none;}
.dep-table tbody td{padding:12px 16px;font-size:13px;vertical-align:middle;}
.emp-cell{display:flex;align-items:center;gap:10px;}
.ec-av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:white;flex-shrink:0;}
.ec-name{font-weight:600;font-size:13px;color:var(--dark);}
.ec-id{font-size:11px;color:var(--gray);}
.zone-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:7px;font-size:11px;font-weight:700;}
.status-chip{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600;}
.status-chip.active{background:rgba(39,174,96,.1);color:var(--success);}
.status-chip.standby{background:rgba(230,126,34,.1);color:var(--warning);}
.status-chip.break{background:rgba(41,128,185,.1);color:var(--info);}
.status-chip.offline{background:rgba(139,123,120,.1);color:var(--gray);}

/* ‚ïê‚ïê MODAL ‚ïê‚ïê */
.modal-overlay{position:fixed;inset:0;background:rgba(26,10,8,.55);z-index:500;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.modal-overlay.open{display:flex;animation:mfade .2s ease;}
@keyframes mfade{from{opacity:0}to{opacity:1}}
.modal{background:var(--white);border-radius:18px;width:520px;max-width:96vw;max-height:92vh;overflow-y:auto;box-shadow:0 24px 64px rgba(26,10,8,.3);animation:mup .25s ease;}
@keyframes mup{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.modal-hdr{display:flex;align-items:center;justify-content:space-between;padding:20px 26px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--white);z-index:10;border-radius:18px 18px 0 0;}
.modal-title{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;color:var(--dark);}
.modal-close{width:34px;height:34px;border-radius:8px;border:1.5px solid var(--border);background:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;color:var(--gray);transition:all .2s;}
.modal-close:hover{background:var(--red);color:white;border-color:var(--red);}
.modal-body{padding:24px 26px;}
.modal-foot{padding:16px 26px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px;background:#FDF9F8;border-radius:0 0 18px 18px;position:sticky;bottom:0;}
.form-group{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.form-group:last-child{margin-bottom:0;}
.form-label{font-size:11px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.7px;}
.form-input,.form-select{background:var(--light-gray);border:1.5px solid var(--border);border-radius:9px;padding:10px 14px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--dark);outline:none;transition:border-color .2s;width:100%;}
.form-input:focus,.form-select:focus{border-color:var(--red);}
.form-select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238B7B78' fill='none' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;cursor:pointer;}
.form-row-2{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.form-row-2 .form-group{margin-bottom:0;}
.form-hint{font-size:11px;color:var(--gray);margin-top:2px;}

/* EMP CHECKBOXES */
.emp-check-grid{border:1.5px solid var(--border);border-radius:10px;max-height:220px;overflow-y:auto;}
.eck-item{display:flex;align-items:center;gap:10px;padding:10px 14px;cursor:pointer;border-bottom:1px solid var(--border);transition:background .15s;}
.eck-item:last-child{border-bottom:none;}
.eck-item:hover{background:var(--light-gray);}
.eck-item.selected{background:rgba(192,57,43,.06);border-left:3px solid var(--red);}
.eck-av{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;color:white;flex-shrink:0;}
.eck-name{font-size:13px;font-weight:600;color:var(--dark);}
.eck-pos{font-size:11px;color:var(--gray);}
.eck-check{margin-left:auto;font-size:16px;color:var(--success);}

/* ZONE DETAIL */
.zd-banner{height:70px;display:flex;align-items:center;padding:0 26px;gap:12px;}
.zd-emp-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.zd-emp-card{display:flex;align-items:center;gap:8px;padding:10px;background:var(--light-gray);border-radius:10px;}
.zd-av{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;color:white;flex-shrink:0;}
.zd-emp-name{font-size:12px;font-weight:600;color:var(--dark);}
.zd-emp-status{font-size:10px;color:var(--gray);}
.zd-remove{margin-left:auto;cursor:pointer;color:var(--gray);font-size:12px;transition:color .15s;}
.zd-remove:hover{color:var(--red);}

/* TOAST */
.toast{position:fixed;bottom:28px;right:28px;z-index:9999;background:var(--dark);color:white;padding:13px 20px;border-radius:12px;font-size:13px;font-weight:500;display:flex;align-items:center;gap:10px;box-shadow:0 8px 32px rgba(0,0,0,.25);opacity:0;transform:translateY(10px);transition:all .3s;pointer-events:none;min-width:240px;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.success{border-left:4px solid var(--success);}
.toast.error{border-left:4px solid var(--red);}
.toast.info{border-left:4px solid var(--info);}
.toast.warning{border-left:4px solid var(--warning);}

@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-badge">
      <div class="logo-icon">üë•</div>
      <div><div class="logo-text">ManPower MS</div><div class="logo-sub">Monitoring System</div></div>
    </div>
  </div>
  <div class="branch-tag"><div class="label">Current Branch</div><div class="value">üìç North Branch ‚Äî NCR</div></div>
  <nav class="nav-section">
    <div class="nav-label">Main Menu</div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">üìä</span> Dashboard</div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">üë§</span> Employees <span class="nav-badge">48</span></div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">üïê</span> Attendance</div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">üìÖ</span> Schedule</div>
    <div class="nav-item active" onclick="setActive(this)"><span class="icon">üîÑ</span> Deployment</div>
    <div class="nav-label" style="margin-top:8px;">Management</div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">üèñÔ∏è</span> Leave Requests <span class="nav-badge">3</span></div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">üìã</span> Reports</div>
    <div class="nav-item" onclick="setActive(this)"><span class="icon">‚öôÔ∏è</span> Settings</div>
  </nav>
  <div class="sidebar-footer">
    <div class="admin-card">
      <div class="admin-av">BA</div>
      <div class="admin-info"><div class="name">Branch Admin</div><div class="role">Administrator</div></div>
      <button class="logout-btn">‚èè</button>
    </div>
  </div>
</aside>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<main class="main">
  <div class="topbar">
    <div class="topbar-left">
      <h1>üîÑ Deployment Panel</h1>
      <div class="subtitle">Manage station assignments, area coverage, and real-time employee deployment.</div>
    </div>
    <div class="topbar-right">
      <div class="live-badge"><div class="live-dot"></div> Live ‚Äî Thu, Feb 19, 2026</div>
      <button class="btn-outline" onclick="showToast('info','üìã Deployment report exported!')">‚¨á Export</button>
      <button class="btn-primary" onclick="openDeployModal()">Ôºã Deploy Employee</button>
      <button class="notif-btn">üîî<span class="nb"></span></button>
    </div>
  </div>

  <div class="content">

    <!-- KPI STRIP -->
    <div class="kpi-strip">
      <div class="kpi">
        <div class="kpi-lbl">Total Deployed</div>
        <div class="kpi-val" id="kpi-deployed">‚Äî</div>
        <div class="kpi-sub">Active right now</div>
        <div class="kpi-icon">üü¢</div>
      </div>
      <div class="kpi g">
        <div class="kpi-lbl">Zones Covered</div>
        <div class="kpi-val" id="kpi-zones">‚Äî</div>
        <div class="kpi-sub">of <span id="kpi-total-zones">‚Äî</span> areas</div>
        <div class="kpi-icon">üìç</div>
      </div>
      <div class="kpi b">
        <div class="kpi-lbl">On Break</div>
        <div class="kpi-val" id="kpi-break">‚Äî</div>
        <div class="kpi-sub">Temporarily away</div>
        <div class="kpi-icon">‚òï</div>
      </div>
      <div class="kpi o">
        <div class="kpi-lbl">Understaffed Zones</div>
        <div class="kpi-val" id="kpi-under">‚Äî</div>
        <div class="kpi-sub">Below minimum</div>
        <div class="kpi-icon">‚ö†Ô∏è</div>
      </div>
      <div class="kpi p">
        <div class="kpi-lbl">Coverage Rate</div>
        <div class="kpi-val" id="kpi-rate">‚Äî<span style="font-size:18px;font-weight:500;">%</span></div>
        <div class="kpi-sub">vs. required staffing</div>
        <div class="kpi-icon">üìä</div>
      </div>
    </div>

    <!-- MAIN LAYOUT -->
    <div class="deploy-layout">

      <!-- LEFT: MAP + TABLE -->
      <div class="map-card">
        <div class="map-card-hdr">
          <div class="map-card-title">üè¨ North Branch ‚Äî Floor Deployment Map</div>
          <div class="map-toolbar">
            <div class="view-tabs">
              <button class="view-tab active" id="vt-map" onclick="switchView('map',this)">üó∫ Map View</button>
              <button class="view-tab" id="vt-table" onclick="switchView('table',this)">üìã Table View</button>
            </div>
            <button class="btn-ghost" onclick="openAddZoneModal()" title="Add Zone">Ôºã Zone</button>
          </div>
        </div>

        <!-- MAP VIEW -->
        <div id="mapView">
          <div class="floor-plan-wrap">
            <div class="floor-plan" id="floorPlan" style="height:420px;"></div>
          </div>
          <div class="floor-legend" id="floorLegend"></div>
        </div>

        <!-- TABLE VIEW -->
        <div id="tableView" class="table-view">
          <table class="dep-table">
            <thead>
              <tr>
                <th>Employee</th>
                <th>Zone / Station</th>
                <th>Shift</th>
                <th>Status</th>
                <th>Since</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="deployTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="right-panel">

        <!-- EMPLOYEE ROSTER -->
        <div class="roster-card">
          <div class="rc-hdr">
            <div class="rc-title">üë• On-Duty Roster</div>
            <span style="font-size:11px;color:var(--gray);" id="rosterCount">‚Äî</span>
          </div>
          <div class="rc-search">
            <span style="font-size:14px;">üîç</span>
            <input type="text" id="rosterSearch" placeholder="Search employee..." oninput="renderRoster()">
          </div>
          <div id="rosterList" style="max-height:260px;overflow-y:auto;"></div>
        </div>

        <!-- ZONE SUMMARY -->
        <div class="zone-summary-card">
          <div class="rc-hdr" style="padding:14px 18px;border-bottom:1px solid var(--border);">
            <div class="rc-title" style="font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;color:var(--dark);display:flex;align-items:center;gap:7px;">üìç Zone Summary</div>
          </div>
          <div id="zoneSummary"></div>
        </div>

        <!-- ALERTS -->
        <div class="alert-card">
          <div class="rc-hdr" style="padding:14px 18px;border-bottom:1px solid var(--border);">
            <div class="rc-title" style="font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;color:var(--dark);display:flex;align-items:center;gap:7px;">üö® Deployment Alerts</div>
          </div>
          <div id="alertsList"></div>
        </div>

      </div>
    </div>
  </div>
</main>

<!-- ‚ïê‚ïê DEPLOY EMPLOYEE MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="deployModal">
  <div class="modal">
    <div class="modal-hdr">
      <div class="modal-title">üîÑ Deploy Employee</div>
      <button class="modal-close" onclick="closeModal('deployModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Employee *</label>
        <select class="form-select" id="dm_emp">
          <option value="">Select employee</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Zone / Station *</label>
        <select class="form-select" id="dm_zone">
          <option value="">Select zone</option>
        </select>
      </div>
      <div class="form-row-2">
        <div class="form-group">
          <label class="form-label">Shift</label>
          <select class="form-select" id="dm_shift">
            <option>Morning (6AM‚Äì2PM)</option>
            <option selected>Day (8AM‚Äì5PM)</option>
            <option>Mid (2PM‚Äì10PM)</option>
            <option>Night (10PM‚Äì6AM)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="dm_status">
            <option value="active">üü¢ Active</option>
            <option value="standby">üü° Standby</option>
            <option value="break">üîµ On Break</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Notes (Optional)</label>
        <input class="form-input" id="dm_notes" placeholder="e.g. Handling cashier 2, covering for absence...">
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn-outline" onclick="closeModal('deployModal')">Cancel</button>
      <button class="btn-primary" onclick="saveDeployment()">üü¢ Deploy Now</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê ZONE DETAIL MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="zoneDetailModal">
  <div class="modal">
    <div class="modal-hdr">
      <div class="modal-title" id="zdm-title">Zone Details</div>
      <button class="modal-close" onclick="closeModal('zoneDetailModal')">‚úï</button>
    </div>
    <div class="modal-body" style="padding:0;">
      <div class="zd-banner" id="zdm-banner"></div>
      <div style="padding:20px 26px;" id="zdm-body"></div>
    </div>
    <div class="modal-foot">
      <button class="btn-outline" onclick="closeModal('zoneDetailModal')">Close</button>
      <button class="btn-primary" onclick="addToZoneFromModal()">Ôºã Add Employee</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê ADD ZONE MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="addZoneModal">
  <div class="modal" style="width:460px;">
    <div class="modal-hdr">
      <div class="modal-title">üìç Add New Zone</div>
      <button class="modal-close" onclick="closeModal('addZoneModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Zone Name *</label>
        <input class="form-input" id="az_name" placeholder="e.g. Cashier Area, Loading Bay...">
      </div>
      <div class="form-group">
        <label class="form-label">Zone Icon</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;" id="iconPicker">
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon active" data-icon="üè™" onclick="pickIcon(this)">üè™</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üè¨" onclick="pickIcon(this)">üè¨</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üõí" onclick="pickIcon(this)">üõí</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üì¶" onclick="pickIcon(this)">üì¶</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üîê" onclick="pickIcon(this)">üîê</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üñ•Ô∏è" onclick="pickIcon(this)">üñ•Ô∏è</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üö™" onclick="pickIcon(this)">üö™</span>
          <span style="font-size:22px;cursor:pointer;padding:6px;border-radius:8px;border:2px solid var(--border);transition:all .2s;" class="ip-icon" data-icon="üÖøÔ∏è" onclick="pickIcon(this)">üÖøÔ∏è</span>
        </div>
      </div>
      <div class="form-row-2">
        <div class="form-group">
          <label class="form-label">Min. Staff Required</label>
          <input class="form-input" type="number" id="az_min" value="2" min="1">
        </div>
        <div class="form-group">
          <label class="form-label">Max. Capacity</label>
          <input class="form-input" type="number" id="az_max" value="5" min="1">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Zone Color</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;" id="zonePicker">
          <div class="cp-dot" style="background:#C0392B;" onclick="pickZoneColor(this,'#C0392B')"></div>
          <div class="cp-dot" style="background:#2980B9;" onclick="pickZoneColor(this,'#2980B9')"></div>
          <div class="cp-dot" style="background:#27AE60;" onclick="pickZoneColor(this,'#27AE60')"></div>
          <div class="cp-dot" style="background:#E67E22;" onclick="pickZoneColor(this,'#E67E22')"></div>
          <div class="cp-dot" style="background:#8E44AD;" onclick="pickZoneColor(this,'#8E44AD')"></div>
          <div class="cp-dot active" style="background:#16A085;" onclick="pickZoneColor(this,'#16A085')"></div>
          <div class="cp-dot" style="background:#D35400;" onclick="pickZoneColor(this,'#D35400')"></div>
          <div class="cp-dot" style="background:#7D3C98;" onclick="pickZoneColor(this,'#7D3C98')"></div>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn-outline" onclick="closeModal('addZoneModal')">Cancel</button>
      <button class="btn-primary" onclick="addZone()">üìç Add Zone</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê DATA ‚ïê‚ïê
let zones = [
  {id:'z1', name:'Cashier Area',    icon:'üí∞', color:'#C0392B', minStaff:3, maxStaff:5, x:5,  y:5,  w:38, h:35},
  {id:'z2', name:'Sales Floor',     icon:'üõí', color:'#2980B9', minStaff:4, maxStaff:8, x:45, y:5,  w:50, h:35},
  {id:'z3', name:'Stockroom',       icon:'üì¶', color:'#E67E22', minStaff:2, maxStaff:4, x:5,  y:45, w:28, h:30},
  {id:'z4', name:'Customer Service',icon:'üéß', color:'#27AE60', minStaff:2, maxStaff:3, x:36, y:45, w:30, h:30},
  {id:'z5', name:'Security Post',   icon:'üîê', color:'#8E44AD', minStaff:2, maxStaff:3, x:69, y:45, w:26, h:30},
  {id:'z6', name:'Admin Office',    icon:'üñ•Ô∏è', color:'#16A085', minStaff:1, maxStaff:3, x:5,  y:78, w:20, h:20},
  {id:'z7', name:'Delivery Bay',    icon:'üöö', color:'#D35400', minStaff:1, maxStaff:3, x:28, y:78, w:20, h:20},
];

const EMPLOYEES = [
  {id:'EMP-001', name:'Maria Reyes',       pos:'Cashier',         color:'#C0392B', initials:'MR'},
  {id:'EMP-002', name:'Juan Dela Cruz',    pos:'Floor Staff',     color:'#922B21', initials:'JD'},
  {id:'EMP-003', name:'Ana Santos',        pos:'Supervisor',      color:'#2980B9', initials:'AS'},
  {id:'EMP-004', name:'Roberto Lim',       pos:'Security',        color:'#27AE60', initials:'RL'},
  {id:'EMP-005', name:'Carla Torres',      pos:'Inventory',       color:'#E67E22', initials:'CT'},
  {id:'EMP-006', name:'Ben Mercado',       pos:'Cashier',         color:'#8E44AD', initials:'BM'},
  {id:'EMP-007', name:'Grace Villanueva',  pos:'HR Assistant',    color:'#16A085', initials:'GV'},
  {id:'EMP-008', name:'Mark Espiritu',     pos:'Security',        color:'#D35400', initials:'ME'},
  {id:'EMP-009', name:'Liza Hernandez',    pos:'Floor Staff',     color:'#1A5276', initials:'LH'},
  {id:'EMP-010', name:'Rico Pascual',      pos:'Delivery',        color:'#7D3C98', initials:'RP'},
  {id:'EMP-011', name:'Diana Flores',      pos:'Customer Svc',    color:'#C0392B', initials:'DF'},
  {id:'EMP-012', name:'Carlos Navarro',    pos:'Floor Staff',     color:'#27AE60', initials:'CN'},
];

let deployments = [
  {id:1,  empId:'EMP-001', zoneId:'z1', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:02', notes:'Main cashier'},
  {id:2,  empId:'EMP-006', zoneId:'z1', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:05', notes:'Cashier 2'},
  {id:3,  empId:'EMP-011', zoneId:'z1', shift:'Day (8AM‚Äì5PM)',     status:'break',   since:'09:45', notes:''},
  {id:4,  empId:'EMP-002', zoneId:'z2', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:00', notes:''},
  {id:5,  empId:'EMP-009', zoneId:'z2', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:00', notes:''},
  {id:6,  empId:'EMP-012', zoneId:'z2', shift:'Day (8AM‚Äì5PM)',     status:'standby', since:'08:30', notes:'Floating'},
  {id:7,  empId:'EMP-005', zoneId:'z3', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:00', notes:'Inventory check'},
  {id:8,  empId:'EMP-003', zoneId:'z4', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:10', notes:'Supervising'},
  {id:9,  empId:'EMP-004', zoneId:'z5', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'06:00', notes:'Main gate'},
  {id:10, empId:'EMP-008', zoneId:'z5', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'06:00', notes:'Back exit'},
  {id:11, empId:'EMP-007', zoneId:'z6', shift:'Day (8AM‚Äì5PM)',     status:'active',  since:'08:00', notes:''},
  {id:12, empId:'EMP-010', zoneId:'z7', shift:'Morning (6AM‚Äì2PM)', status:'active',  since:'06:30', notes:'Morning delivery'},
];

const STATUS_META = {
  active:  {label:'Active',  color:'var(--success)', dot:'üü¢'},
  standby: {label:'Standby', color:'var(--warning)', dot:'üü°'},
  break:   {label:'On Break',color:'var(--info)',    dot:'üîµ'},
  offline: {label:'Offline', color:'var(--gray)',    dot:'‚ö´'},
};

let selectedZoneIcon = 'üè™';
let selectedZoneColor = '#16A085';
let currentView = 'map';
let focusedZoneId = null;

// ‚ïê‚ïê INIT ‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  render();
  populateDeployModalSelects();
});

function render() {
  updateKPIs();
  renderFloorPlan();
  renderFloorLegend();
  renderDeployTable();
  renderRoster();
  renderZoneSummary();
  renderAlerts();
}

// ‚ïê‚ïê KPIs ‚ïê‚ïê
function updateKPIs() {
  const deployedEmpIds = new Set(deployments.map(d => d.empId));
  const onBreak = deployments.filter(d => d.status === 'break').length;
  const coveredZones = new Set(deployments.map(d => d.zoneId)).size;
  const understaffedZones = zones.filter(z => {
    const count = deployments.filter(d => d.zoneId === z.id && d.status !== 'break').length;
    return count < z.minStaff;
  }).length;
  const totalRequired = zones.reduce((s,z) => s + z.minStaff, 0);
  const totalDeployed = deployments.filter(d => d.status === 'active' || d.status === 'standby').length;
  const rate = Math.round(Math.min(100, (totalDeployed / totalRequired) * 100));

  document.getElementById('kpi-deployed').textContent = deployedEmpIds.size;
  document.getElementById('kpi-zones').textContent = coveredZones;
  document.getElementById('kpi-total-zones').textContent = zones.length;
  document.getElementById('kpi-break').textContent = onBreak;
  document.getElementById('kpi-under').textContent = understaffedZones;
  document.getElementById('kpi-rate').innerHTML = rate + '<span style="font-size:18px;font-weight:500;">%</span>';
}

// ‚ïê‚ïê FLOOR PLAN ‚ïê‚ïê
function renderFloorPlan() {
  const plan = document.getElementById('floorPlan');
  plan.innerHTML = zones.map(z => {
    const zoneEmps = deployments.filter(d => d.zoneId === z.id);
    const activeCount = zoneEmps.filter(d => d.status === 'active').length;
    const isUnder = activeCount < z.minStaff;
    const isFull = activeCount >= z.maxStaff;
    const statusColor = isUnder ? 'var(--red)' : isFull ? 'var(--success)' : 'var(--warning)';
    const bg = hexToRgba(z.color, 0.10);
    const border = hexToRgba(z.color, isUnder ? 0.7 : 0.35);

    const empDots = zoneEmps.slice(0, 6).map(d => {
      const emp = EMPLOYEES.find(e => e.id === d.empId);
      const sm = STATUS_META[d.status];
      return `<div class="zone-emp-dot" style="background:${emp?.color || '#999'};" 
        title="${emp?.name} ‚Äî ${sm.label}" onclick="event.stopPropagation();openEmpQuickEdit(${d.id})">
        ${emp?.initials || '?'}
      </div>`;
    }).join('');

    const extra = zoneEmps.length > 6 ? `<div class="zone-emp-dot" style="background:var(--gray);">+${zoneEmps.length-6}</div>` : '';

    return `<div class="zone" onclick="openZoneDetail('${z.id}')"
      style="left:${z.x}%;top:${z.y}%;width:${z.w}%;height:${z.h}%;background:${bg};border-color:${border};">
      <div class="zone-header">
        <div class="zone-name" style="color:${z.color};">${z.icon} ${z.name}</div>
        <div class="zone-count" style="color:${z.color};">${activeCount}/${z.minStaff}</div>
      </div>
      <div class="zone-emps">${empDots}${extra}
        <div class="add-to-zone" style="border-color:${hexToRgba(z.color,.5)};color:${hexToRgba(z.color,.7)};"
          onclick="event.stopPropagation();quickAddToZone('${z.id}')">Ôºã</div>
      </div>
      <div class="zone-status-bar" style="background:${hexToRgba(z.color,.15)};">
        <div style="height:100%;width:${Math.min(100,Math.round((activeCount/z.maxStaff)*100))}%;background:${statusColor};border-radius:0 0 0 12px;transition:width .5s;"></div>
      </div>
    </div>`;
  }).join('');
}

function renderFloorLegend() {
  const activeCount = deployments.filter(d => d.status === 'active').length;
  const breakCount = deployments.filter(d => d.status === 'break').length;
  const standbyCount = deployments.filter(d => d.status === 'standby').length;
  document.getElementById('floorLegend').innerHTML = `
    <div class="fl-item"><div class="fl-dot" style="background:var(--success);"></div>Active (${activeCount})</div>
    <div class="fl-item"><div class="fl-dot" style="background:var(--warning);"></div>Standby (${standbyCount})</div>
    <div class="fl-item"><div class="fl-dot" style="background:var(--info);"></div>On Break (${breakCount})</div>
    <div class="fl-item"><div class="fl-dot" style="background:var(--red);opacity:.5;border:1px dashed var(--red);"></div>Understaffed</div>
    <div class="fl-item" style="margin-left:auto;color:var(--gray);font-size:11px;">Click any zone or employee dot for details</div>`;
}

// ‚ïê‚ïê ZONE DETAIL ‚ïê‚ïê
function openZoneDetail(zoneId) {
  focusedZoneId = zoneId;
  const z = zones.find(x => x.id === zoneId);
  const zoneEmps = deployments.filter(d => d.zoneId === zoneId);
  const activeCount = zoneEmps.filter(d => d.status === 'active').length;
  const isUnder = activeCount < z.minStaff;

  document.getElementById('zdm-title').textContent = `${z.icon} ${z.name}`;
  document.getElementById('zdm-banner').style.background = `linear-gradient(135deg,${z.color}cc,${z.color}88)`;
  document.getElementById('zdm-banner').innerHTML = `
    <div style="font-size:32px;">${z.icon}</div>
    <div>
      <div style="font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;color:white;">${z.name}</div>
      <div style="font-size:12px;color:rgba(255,255,255,.8);">
        ${activeCount} active ¬∑ Min: ${z.minStaff} ¬∑ Max: ${z.maxStaff}
        ${isUnder ? '<span style="background:rgba(255,255,255,.25);padding:2px 8px;border-radius:20px;margin-left:8px;font-weight:700;">‚ö†Ô∏è Understaffed</span>' : ''}
      </div>
    </div>`;

  document.getElementById('zdm-body').innerHTML = `
    <div style="margin-bottom:16px;">
      <div style="font-size:11px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;margin-bottom:10px;">üë• Deployed Here (${zoneEmps.length})</div>
      ${zoneEmps.length === 0 
        ? `<div style="text-align:center;padding:24px;background:var(--light-gray);border-radius:10px;color:var(--gray);">
            <div style="font-size:28px;margin-bottom:6px;">üì≠</div>
            <div style="font-size:13px;font-weight:600;">No one deployed here yet.</div>
           </div>`
        : `<div class="zd-emp-row">${zoneEmps.map(d => {
            const emp = EMPLOYEES.find(e => e.id === d.empId);
            const sm = STATUS_META[d.status];
            return `<div class="zd-emp-card">
              <div class="zd-av" style="background:${emp?.color}">${emp?.initials}</div>
              <div style="flex:1;min-width:0;">
                <div class="zd-emp-name">${emp?.name}</div>
                <div class="zd-emp-status">${sm.dot} ${sm.label} ¬∑ Since ${d.since}</div>
              </div>
              <div class="zd-remove" onclick="removeDeployment(${d.id},'${zoneId}')">‚úï</div>
            </div>`;
          }).join('')}</div>`}
    </div>
    <div style="display:flex;gap:10px;">
      <div style="flex:1;background:var(--light-gray);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-size:10px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;">Min Required</div>
        <div style="font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;color:var(--dark);">${z.minStaff}</div>
      </div>
      <div style="flex:1;background:var(--light-gray);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-size:10px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;">Currently Active</div>
        <div style="font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;color:${isUnder?'var(--red)':'var(--success)'};">${activeCount}</div>
      </div>
      <div style="flex:1;background:var(--light-gray);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-size:10px;font-weight:700;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;">Max Capacity</div>
        <div style="font-family:'Rajdhani',sans-serif;font-size:24px;font-weight:700;color:var(--dark);">${z.maxStaff}</div>
      </div>
    </div>`;

  openModal('zoneDetailModal');
}

function removeDeployment(depId, zoneId) {
  deployments = deployments.filter(d => d.id !== depId);
  render();
  openZoneDetail(zoneId);
  showToast('success', '‚úÖ Employee removed from zone.');
}

function addToZoneFromModal() {
  closeModal('zoneDetailModal');
  if (focusedZoneId) {
    document.getElementById('dm_zone').value = focusedZoneId;
  }
  openModal('deployModal');
}

function quickAddToZone(zoneId) {
  focusedZoneId = zoneId;
  document.getElementById('dm_zone').value = zoneId;
  openModal('deployModal');
}

// ‚ïê‚ïê EMP QUICK EDIT ‚ïê‚ïê
function openEmpQuickEdit(depId) {
  const dep = deployments.find(d => d.id === depId);
  if (!dep) return;
  const emp = EMPLOYEES.find(e => e.id === dep.empId);
  const zone = zones.find(z => z.id === dep.zoneId);
  const sm = STATUS_META[dep.status];

  // Quick status cycle
  const statuses = ['active','standby','break'];
  const nextIdx = (statuses.indexOf(dep.status) + 1) % statuses.length;
  dep.status = statuses[nextIdx];
  render();
  showToast('info', `${emp?.name} ‚Üí ${STATUS_META[dep.status].label}`);
}

// ‚ïê‚ïê TABLE VIEW ‚ïê‚ïê
function renderDeployTable() {
  document.getElementById('deployTableBody').innerHTML = deployments.map(d => {
    const emp = EMPLOYEES.find(e => e.id === d.empId);
    const zone = zones.find(z => z.id === d.zoneId);
    const sm = STATUS_META[d.status];
    return `<tr onclick="openZoneDetail('${d.zoneId}')">
      <td>
        <div class="emp-cell">
          <div class="ec-av" style="background:${emp?.color}">${emp?.initials}</div>
          <div><div class="ec-name">${emp?.name}</div><div class="ec-id">${emp?.id} ¬∑ ${emp?.pos}</div></div>
        </div>
      </td>
      <td><span class="zone-badge" style="background:${hexToRgba(zone?.color||'#999',.12)};color:${zone?.color};">${zone?.icon} ${zone?.name}</span></td>
      <td><span style="font-size:12px;color:var(--gray);">${d.shift}</span></td>
      <td><span class="status-chip ${d.status}">${sm.dot} ${sm.label}</span></td>
      <td><span style="font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:600;color:var(--dark);">${d.since}</span></td>
      <td>
        <div style="display:flex;gap:6px;">
          <button class="icon-btn" title="Edit" onclick="event.stopPropagation();editDeployment(${d.id})">‚úèÔ∏è</button>
          <button class="icon-btn" title="Remove" onclick="event.stopPropagation();removeDeployment(${d.id},'${d.zoneId}')">üóë</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

function editDeployment(id) {
  const dep = deployments.find(d => d.id === id);
  if (!dep) return;
  document.getElementById('dm_emp').value = dep.empId;
  document.getElementById('dm_zone').value = dep.zoneId;
  document.getElementById('dm_status').value = dep.status;
  document.getElementById('dm_notes').value = dep.notes || '';
  deployments = deployments.filter(d => d.id !== id);
  openModal('deployModal');
}

// ‚ïê‚ïê ROSTER ‚ïê‚ïê
function renderRoster() {
  const q = document.getElementById('rosterSearch').value.toLowerCase();
  const deployedIds = new Set(deployments.map(d => d.empId));
  const count = deployedIds.size;
  document.getElementById('rosterCount').textContent = `${count} of ${EMPLOYEES.length} on duty`;

  const filtered = EMPLOYEES.filter(e => !q || (e.name + e.pos).toLowerCase().includes(q));
  document.getElementById('rosterList').innerHTML = filtered.map(e => {
    const dep = deployments.find(d => d.empId === e.id);
    const zone = dep ? zones.find(z => z.id === dep.zoneId) : null;
    const sm = dep ? STATUS_META[dep.status] : null;
    const isDeployed = !!dep;
    return `<div class="roster-item" onclick="${isDeployed ? `openZoneDetail('${dep?.zoneId}')` : `openDeployForEmp('${e.id}')`}">
      <div class="ri-av" style="background:${e.color}">
        ${e.initials}
        <div class="ri-status" style="background:${isDeployed ? (sm?.color || 'var(--gray)') : 'var(--gray)'}"></div>
      </div>
      <div style="flex:1;min-width:0;">
        <div class="ri-name">${e.name}</div>
        <div class="ri-pos">${e.pos}</div>
      </div>
      ${isDeployed 
        ? `<span class="ri-zone" style="background:${hexToRgba(zone?.color||'#999',.12)};color:${zone?.color};">${zone?.icon}</span>` 
        : `<span style="font-size:10px;color:var(--gray);background:var(--light-gray);padding:2px 7px;border-radius:5px;font-weight:600;">Undeployed</span>`}
    </div>`;
  }).join('');
}

function openDeployForEmp(empId) {
  document.getElementById('dm_emp').value = empId;
  openModal('deployModal');
}

// ‚ïê‚ïê ZONE SUMMARY ‚ïê‚ïê
function renderZoneSummary() {
  document.getElementById('zoneSummary').innerHTML = zones.map(z => {
    const active = deployments.filter(d => d.zoneId === z.id && d.status === 'active').length;
    const total = deployments.filter(d => d.zoneId === z.id).length;
    const isUnder = active < z.minStaff;
    const pct = Math.min(100, Math.round((active / z.maxStaff) * 100));
    const col = isUnder ? 'var(--red)' : active >= z.maxStaff ? 'var(--success)' : 'var(--warning)';
    return `<div class="zs-item" onclick="openZoneDetail('${z.id}')">
      <div class="zs-left">
        <div class="zs-color" style="background:${z.color};"></div>
        <div>
          <div class="zs-name">${z.icon} ${z.name}</div>
          <div class="zs-req">Min: ${z.minStaff} ¬∑ Max: ${z.maxStaff}</div>
        </div>
      </div>
      <div class="zs-right">
        <div class="zs-bar-wrap"><div class="zs-bar-fill" style="width:${pct}%;background:${col};"></div></div>
        <div class="zs-count" style="color:${col};">${active}</div>
        ${isUnder ? '<span style="font-size:14px;">‚ö†Ô∏è</span>' : ''}
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê ALERTS ‚ïê‚ïê
function renderAlerts() {
  const alerts = [];
  zones.forEach(z => {
    const active = deployments.filter(d => d.zoneId === z.id && d.status === 'active').length;
    if (active < z.minStaff) {
      alerts.push({icon:'‚ö†Ô∏è', title:`${z.name} is understaffed`, sub:`${active} active of ${z.minStaff} required. Deploy more staff.`, time:'Now', urgent:true});
    }
  });
  const breaking = deployments.filter(d => d.status === 'break');
  if (breaking.length > 0) {
    const emp = EMPLOYEES.find(e => e.id === breaking[0].empId);
    alerts.push({icon:'‚òï', title:`${breaking.length} employee(s) on break`, sub:`${emp?.name} and others are temporarily away from their stations.`, time:'Now', urgent:false});
  }
  alerts.push({icon:'‚úÖ', title:'Security coverage at 100%', sub:'Both security posts are fully staffed as required.', time:'8:00 AM', urgent:false});
  alerts.push({icon:'üìã', title:'Morning deployment complete', sub:'All employees successfully deployed for the morning shift.', time:'8:15 AM', urgent:false});

  document.getElementById('alertsList').innerHTML = alerts.slice(0,5).map(a => `
    <div class="alert-item" style="${a.urgent?'border-left:3px solid var(--red);':''}" >
      <div class="alert-icon">${a.icon}</div>
      <div>
        <div class="alert-title" style="color:${a.urgent?'var(--red)':'var(--dark)'};">${a.title}</div>
        <div class="alert-sub">${a.sub}</div>
        <div class="alert-time">üïê ${a.time}</div>
      </div>
    </div>`).join('');
}

// ‚ïê‚ïê DEPLOY MODAL ‚ïê‚ïê
function openDeployModal() {
  document.getElementById('dm_emp').value = '';
  document.getElementById('dm_zone').value = focusedZoneId || '';
  document.getElementById('dm_notes').value = '';
  openModal('deployModal');
}

function populateDeployModalSelects() {
  document.getElementById('dm_emp').innerHTML = '<option value="">Select employee</option>' +
    EMPLOYEES.map(e => `<option value="${e.id}">${e.name} (${e.pos})</option>`).join('');
  document.getElementById('dm_zone').innerHTML = '<option value="">Select zone</option>' +
    zones.map(z => `<option value="${z.id}">${z.icon} ${z.name}</option>`).join('');
}

function saveDeployment() {
  const empId = document.getElementById('dm_emp').value;
  const zoneId = document.getElementById('dm_zone').value;
  const shift = document.getElementById('dm_shift').value;
  const status = document.getElementById('dm_status').value;
  const notes = document.getElementById('dm_notes').value;

  if (!empId) { showToast('error', '‚ö†Ô∏è Please select an employee.'); return; }
  if (!zoneId) { showToast('error', '‚ö†Ô∏è Please select a zone.'); return; }

  const now = new Date();
  const since = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
  const newId = Math.max(0, ...deployments.map(d => d.id)) + 1;
  deployments.push({id: newId, empId, zoneId, shift, status, since, notes});

  const emp = EMPLOYEES.find(e => e.id === empId);
  const zone = zones.find(z => z.id === zoneId);
  closeModal('deployModal');
  render();
  showToast('success', `üü¢ ${emp?.name} deployed to ${zone?.icon} ${zone?.name}!`);
}

// ‚ïê‚ïê ADD ZONE ‚ïê‚ïê
function openAddZoneModal() { openModal('addZoneModal'); }

function addZone() {
  const name = document.getElementById('az_name').value.trim();
  const min = parseInt(document.getElementById('az_min').value) || 2;
  const max = parseInt(document.getElementById('az_max').value) || 5;
  if (!name) { showToast('error', '‚ö†Ô∏è Please enter a zone name.'); return; }

  const newZone = {
    id: 'z' + (Date.now()),
    name, icon: selectedZoneIcon, color: selectedZoneColor,
    minStaff: min, maxStaff: max,
    x: 52, y: 78, w: 20, h: 20
  };
  zones.push(newZone);
  populateDeployModalSelects();
  render();
  closeModal('addZoneModal');
  document.getElementById('az_name').value = '';
  showToast('success', `üìç Zone "${name}" added!`);
}

function pickIcon(el) {
  selectedZoneIcon = el.dataset.icon;
  document.querySelectorAll('.ip-icon').forEach(i => { i.classList.remove('active'); i.style.borderColor = 'var(--border)'; i.style.background = ''; });
  el.classList.add('active');
  el.style.borderColor = 'var(--red)';
  el.style.background = 'rgba(192,57,43,.07)';
}

function pickZoneColor(el, col) {
  selectedZoneColor = col;
  document.querySelectorAll('#zonePicker .cp-dot').forEach(d => d.classList.remove('active'));
  el.classList.add('active');
}

// ‚ïê‚ïê VIEW SWITCH ‚ïê‚ïê
function switchView(view, btn) {
  currentView = view;
  document.querySelectorAll('.view-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('mapView').style.display = view === 'map' ? 'block' : 'none';
  document.getElementById('tableView').style.display = view === 'table' ? 'block' : 'none';
}

// ‚ïê‚ïê HELPERS ‚ïê‚ïê
function hexToRgba(hex, a) {
  if (!hex || !hex.startsWith('#')) return `rgba(128,128,128,${a})`;
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a})`;
}
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); });
});
function setActive(el) { document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); el.classList.add('active'); }
function showToast(type, msg) {
  const t = document.getElementById('toast');
  t.className = `toast ${type} show`;
  t.textContent = msg;
  setTimeout(() => t.classList.remove('show'), 3200);
}
</script>
</body>
</html>