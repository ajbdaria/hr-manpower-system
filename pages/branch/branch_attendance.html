<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance ‚Äî Manpower Monitoring System</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
:root{
  --red:#C0392B;--red-bright:#E74C3C;--red-dark:#922B21;
  --red-glow:rgba(192,57,43,0.14);
  --dark:#610e03;--dark2:#2C1410;--dark3:#3D1A15;
  --gray:#8B7B78;--light-gray:#F4EAE8;--cream:#FDF6F0;--white:#FFFFFF;
  --success:#27AE60;--warning:#E67E22;--info:#2980B9;--purple:#8E44AD;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:#F8F0EE;color:var(--dark);min-height:100vh;display:flex;}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{width:240px;min-height:100vh;background:var(--dark);position:fixed;left:0;top:0;bottom:0;z-index:100;border-right:2px solid var(--red-dark);display:flex;flex-direction:column;}
.sidebar-logo{padding:28px 20px 20px;border-bottom:1px solid var(--dark3);}
.logo-badge{display:flex;align-items:center;gap:10px;}
.logo-icon{width:38px;height:38px;background:var(--red);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;}
.logo-text{font-family:'Rajdhani',sans-serif;font-size:17px;font-weight:700;color:var(--white);line-height:1.2;}
.logo-sub{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:1px;}
.branch-tag{margin:14px 20px;background:var(--red-glow);border:1px solid var(--red-dark);border-radius:6px;padding:8px 12px;}
.branch-tag .label{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:1px;}
.branch-tag .value{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:600;color:var(--red-bright);}
.nav-section{padding:8px 0;flex:1;}
.nav-label{padding:14px 20px 6px;font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:1.5px;}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 20px;color:#A89693;cursor:pointer;transition:all .2s;font-size:14px;font-weight:500;border-left:3px solid transparent; text-decoration: none;}
.nav-item:hover,.nav-item.active{color:var(--white);background:rgba(192,57,43,.12);border-left-color:var(--red);}
.nav-item.active{color:var(--red-bright);}
.nav-item .icon{width:20px;text-align:center;font-size:16px;}
.nav-badge{margin-left:auto;background:var(--red);color:white;font-size:10px;font-weight:700;padding:2px 7px;border-radius:20px;}
.sidebar-footer{padding:16px 20px;border-top:1px solid var(--dark3);}
.admin-card{display:flex;align-items:center;gap:10px;}
.admin-avatar{width:36px;height:36px;background:var(--red);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:14px;color:white;flex-shrink:0;}
.admin-info .name{font-size:13px;font-weight:600;color:var(--white);}
.admin-info .role{font-size:11px;color:var(--gray);}
.logout-btn{margin-left:auto;background:none;border:none;color:var(--gray);cursor:pointer;font-size:16px;transition:color .2s;}
.logout-btn:hover{color:var(--red-bright);}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main{margin-left:240px;flex:1;display:flex;flex-direction:column;min-height:100vh;}
.topbar{background:var(--white);border-bottom:1px solid #E8D8D5;padding:14px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;box-shadow:0 2px 8px rgba(192,57,43,.06);}
.topbar-left h1{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;letter-spacing:.5px;}
.topbar-left .subtitle{font-size:12px;color:var(--gray);margin-top:1px;}
.topbar-right{display:flex;align-items:center;gap:12px;}
.live-dot{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:500;color:var(--success);}
.dot{width:8px;height:8px;background:var(--success);border-radius:50%;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.5;transform:scale(1.3);}}
.topbar-date{font-size:12px;color:var(--gray);background:var(--light-gray);padding:6px 12px;border-radius:6px;}
.notif-btn{position:relative;background:var(--light-gray);border:none;cursor:pointer;width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;transition:background .2s;}
.notif-btn:hover{background:#E8D8D5;}
.notif-btn .badge{position:absolute;top:4px;right:4px;width:8px;height:8px;background:var(--red);border-radius:50%;border:2px solid var(--white);}

.content{padding:24px 32px;}

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stat-row{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:22px;}
.sc{background:var(--white);border-radius:12px;padding:16px 18px;border:1px solid #EDD8D5;position:relative;overflow:hidden;cursor:pointer;transition:all .2s;animation:fadeUp .4s ease both;}
.sc:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(192,57,43,.1);}
.sc::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--red);}
.sc.g::after{background:var(--success);}
.sc.o::after{background:var(--warning);}
.sc.b::after{background:var(--info);}
.sc.p::after{background:var(--purple);}
.sc-lbl{font-size:11px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:.7px;margin-bottom:8px;}
.sc-val{font-family:'Rajdhani',sans-serif;font-size:32px;font-weight:700;color:var(--dark);line-height:1;}
.sc-sub{font-size:11px;color:var(--gray);margin-top:4px;}
.sc-icon{position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:28px;opacity:.15;}

/* ‚îÄ‚îÄ MAIN GRID ‚îÄ‚îÄ */
.mg{display:grid;grid-template-columns:1fr 380px;gap:20px;margin-bottom:20px;}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--white);border-radius:14px;border:1px solid #EDD8D5;overflow:hidden;animation:fadeUp .4s ease .2s both;}
.card-hdr{padding:16px 22px;border-bottom:1px solid #F4EAE8;display:flex;align-items:center;justify-content:space-between;}
.card-title{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;color:var(--dark);display:flex;align-items:center;gap:8px;}
.card-body{padding:20px 22px;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn-primary{background:var(--red);color:white;border:none;padding:9px 18px;border-radius:9px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:background .2s;display:flex;align-items:center;gap:6px;white-space:nowrap;}
.btn-primary:hover{background:var(--red-dark);}
.btn-primary:disabled{background:#ccc;cursor:not-allowed;}
.btn-outline{background:none;color:var(--gray);border:1.5px solid #EDD8D5;padding:8px 14px;border-radius:9px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:6px;white-space:nowrap;}
.btn-outline:hover{border-color:var(--red);color:var(--red);}
.btn-success{background:var(--success);color:white;border:none;padding:9px 18px;border-radius:9px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:background .2s;display:flex;align-items:center;gap:6px;}
.btn-success:hover{background:#219a52;}

/* ‚îÄ‚îÄ ATTENDANCE TABLE ‚îÄ‚îÄ */
.att-table{width:100%;border-collapse:collapse;}
.att-table thead th{padding:11px 14px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--gray);text-align:left;border-bottom:2px solid #EDD8D5;background:#FDF6F0;white-space:nowrap;}
.att-table tbody tr{border-bottom:1px solid #F9F3F2;transition:background .15s;cursor:default;}
.att-table tbody tr:hover{background:#FDF6F0;}
.att-table tbody tr:last-child{border-bottom:none;}
.att-table tbody td{padding:12px 14px;font-size:13px;vertical-align:middle;}

.emp-cell{display:flex;align-items:center;gap:10px;}
.av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;color:white;flex-shrink:0;}
.en{font-weight:600;font-size:13px;}
.ei{font-size:11px;color:var(--gray);}

.pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;}
.pill.present{background:rgba(39,174,96,.1);color:var(--success);}
.pill.absent{background:rgba(192,57,43,.1);color:var(--red);}
.pill.late{background:rgba(230,126,34,.1);color:var(--warning);}
.pill.leave{background:rgba(41,128,185,.1);color:var(--info);}
.pill.halfday{background:rgba(142,68,173,.1);color:var(--purple);}
.pill-dot{width:6px;height:6px;border-radius:50%;background:currentColor;}

.time-cell{font-family:'Rajdhani',sans-serif;font-weight:600;font-size:14px;}
.dist-ok{color:var(--success);font-size:12px;font-weight:600;}
.dist-fail{color:var(--red);font-size:12px;font-weight:600;}

/* ‚îÄ‚îÄ GEOFENCE PANEL ‚îÄ‚îÄ */
.geofence-panel{display:flex;flex-direction:column;gap:16px;}

.geo-status-bar{
  display:flex;align-items:center;gap:10px;
  padding:12px 16px;border-radius:10px;
  font-size:13px;font-weight:600;
}
.geo-status-bar.active{background:rgba(39,174,96,.12);color:var(--success);border:1.5px solid rgba(39,174,96,.3);}
.geo-status-bar.inactive{background:rgba(192,57,43,.1);color:var(--red);border:1.5px solid rgba(192,57,43,.2);}
.geo-icon{font-size:20px;}

#map{
  width:100%;height:260px;border-radius:12px;
  border:2px solid #EDD8D5;overflow:hidden;
  cursor:crosshair;
  transition:border-color .2s;
}
#map:hover{border-color:var(--red);}
.map-hint{font-size:11px;color:var(--gray);text-align:center;margin-top:6px;display:flex;align-items:center;justify-content:center;gap:4px;}

.geo-coords{
  background:var(--light-gray);border-radius:10px;padding:12px 14px;
  display:grid;grid-template-columns:1fr 1fr;gap:8px;
}
.geo-coord-item .lbl{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;font-weight:600;}
.geo-coord-item .val{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;color:var(--dark);margin-top:2px;}

.radius-control{background:var(--light-gray);border-radius:10px;padding:14px;}
.radius-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.radius-label{font-size:13px;font-weight:600;color:var(--dark);}
.radius-val{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;color:var(--red);}
input[type=range]{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:linear-gradient(to right,var(--red) var(--pct,50%),#EDD8D5 var(--pct,50%));outline:none;cursor:pointer;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--red);border:3px solid white;box-shadow:0 2px 8px rgba(192,57,43,.4);cursor:pointer;}
.radius-presets{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap;}
.rp-btn{padding:5px 12px;border-radius:6px;border:1.5px solid #EDD8D5;background:white;font-size:12px;font-weight:600;color:var(--gray);cursor:pointer;transition:all .2s;}
.rp-btn:hover,.rp-btn.active{background:var(--red);border-color:var(--red);color:white;}

.geo-save-row{display:flex;gap:8px;}

/* ‚îÄ‚îÄ SEARCH / FILTER TOOLBAR ‚îÄ‚îÄ */
.att-toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:16px;}
.search-wrap{display:flex;align-items:center;gap:8px;background:var(--light-gray);border:1.5px solid #EDD8D5;border-radius:9px;padding:8px 14px;flex:1;min-width:180px;transition:border-color .2s;}
.search-wrap:focus-within{border-color:var(--red);}
.search-wrap input{background:none;border:none;outline:none;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--dark);width:100%;}
.search-wrap input::placeholder{color:var(--gray);}
.filter-sel{background:var(--light-gray);border:1.5px solid #EDD8D5;border-radius:9px;padding:8px 14px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--dark);cursor:pointer;outline:none;transition:border-color .2s;appearance:none;padding-right:28px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238B7B78' fill='none' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;}
.filter-sel:focus{border-color:var(--red);}

/* ‚îÄ‚îÄ MANUAL OVERRIDE MODAL ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(26,10,8,.55);z-index:1000;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.modal-overlay.open{display:flex;animation:fadeIn .2s ease;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--white);border-radius:18px;width:480px;max-width:96vw;max-height:90vh;overflow-y:auto;box-shadow:0 24px 64px rgba(26,10,8,.3);animation:slideUp .25s ease;}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.modal-hdr{display:flex;align-items:center;justify-content:space-between;padding:20px 26px;border-bottom:1px solid #EDD8D5;position:sticky;top:0;background:var(--white);z-index:10;border-radius:18px 18px 0 0;}
.modal-title{font-family:'Rajdhani',sans-serif;font-size:18px;font-weight:700;}
.modal-close{width:34px;height:34px;border-radius:8px;border:1.5px solid #EDD8D5;background:none;cursor:pointer;font-size:18px;display:flex;align-items:center;justify-content:center;color:var(--gray);transition:all .2s;}
.modal-close:hover{background:var(--red);color:white;border-color:var(--red);}
.modal-body{padding:24px 26px;}
.modal-foot{padding:16px 26px;border-top:1px solid #EDD8D5;display:flex;justify-content:flex-end;gap:10px;position:sticky;bottom:0;background:var(--white);border-radius:0 0 18px 18px;}

.form-group{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.form-label{font-size:12px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;}
.form-input,.form-select{background:var(--light-gray);border:1.5px solid #EDD8D5;border-radius:9px;padding:10px 14px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--dark);outline:none;transition:border-color .2s;}
.form-input:focus,.form-select:focus{border-color:var(--red);}
.form-select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238B7B78' fill='none' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;cursor:pointer;}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;top:24px;right:24px;z-index:9999;background:var(--dark);color:white;padding:13px 20px;border-radius:10px;font-size:13px;font-weight:500;display:flex;align-items:center;gap:10px;box-shadow:0 8px 24px rgba(0,0,0,.2);opacity:0;transform:translateY(-10px);transition:all .3s;pointer-events:none;min-width:240px;}
.toast.show{opacity:1;transform:translateY(0);}
.toast.success{border-left:4px solid var(--success);}
.toast.error{border-left:4px solid var(--red);}
.toast.info{border-left:4px solid var(--info);}

/* ‚îÄ‚îÄ CALENDAR STRIP ‚îÄ‚îÄ */
.cal-strip{display:flex;gap:6px;margin-bottom:16px;overflow-x:auto;padding-bottom:4px;}
.cal-day{flex-shrink:0;width:50px;text-align:center;border-radius:10px;padding:8px 4px;cursor:pointer;transition:all .2s;border:1.5px solid #EDD8D5;background:var(--white);}
.cal-day:hover{border-color:var(--red);}
.cal-day.active{background:var(--red);border-color:var(--red);}
.cal-day .wd{font-size:10px;font-weight:600;color:var(--gray);text-transform:uppercase;}
.cal-day .dn{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;color:var(--dark);}
.cal-day .dot-row{display:flex;justify-content:center;gap:2px;margin-top:3px;}
.cal-day .dd{width:5px;height:5px;border-radius:50%;}
.cal-day.active .wd,.cal-day.active .dn{color:white;}
.cal-day.active .dd{opacity:.7;}

/* ‚îÄ‚îÄ BOTTOM ROW ‚îÄ‚îÄ */
.bottom-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;}

/* LOG ITEM */
.log-item{display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid #F4EAE8;}
.log-item:last-child{border-bottom:none;}
.log-icon{font-size:18px;margin-top:2px;}
.log-text{font-size:13px;font-weight:500;}
.log-sub{font-size:11px;color:var(--gray);margin-top:2px;}
.log-time{margin-left:auto;font-size:11px;color:var(--gray);flex-shrink:0;}

/* ANIMATE */
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.sc:nth-child(1){animation-delay:.0s}
.sc:nth-child(2){animation-delay:.06s}
.sc:nth-child(3){animation-delay:.12s}
.sc:nth-child(4){animation-delay:.18s}
.sc:nth-child(5){animation-delay:.24s}

/* Leaflet override */
.leaflet-control-attribution{font-size:9px;}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-badge">
      <div class="logo-icon">üë•</div>
      <div><div class="logo-text">ManPower MS</div><div class="logo-sub">Monitoring System</div></div>
    </div>
  </div>
  <div class="branch-tag"><div class="label">Current Branch</div><div class="value">üìç North Branch ‚Äî NCR</div></div>
  <nav class="nav-section">
  <div class="nav-label">Main Menu</div>

  <a href="/pages/branch/branch_dashboard.html"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">üìä</span> Dashboard
  </a>

  <a href="/pages/branch/branch_employee.html"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">üë§</span> Employees 
    <span class="nav-badge">48</span>
  </a>

  <a href="/pages/branch/branch_attendance.html"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">üïê</span> Attendance
  </a>

  <a href="#"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">üìÖ</span> Schedule
  </a>

  <a href="#"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">üîÑ</span> Deployment
  </a>

  <div class="nav-label" style="margin-top:8px;">Management</div>

  <a href="/pages/branch/branch_leave_req.html"
     class="nav-item active"
     onclick="setActive(this)">
    <span class="icon">üèñÔ∏è</span> Leave Requests 
    <span class="nav-badge" id="pendingBadge">3</span>
  </a>

  <a href="/pages/branch/branch_reports.html"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">üìã</span> Reports
  </a>

  <a href="/pages/branch/branch_setting.html"
     class="nav-item"
     onclick="setActive(this)">
    <span class="icon">‚öôÔ∏è</span> Settings
  </a>
</nav>
  <div class="sidebar-footer">
    <div class="admin-card">
      <div class="admin-avatar">BA</div>
      <div class="admin-info"><div class="name">Branch Admin</div><div class="role">Administrator</div></div>
      <button class="logout-btn">‚èè</button>
    </div>
  </div>
</aside>

<!-- ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê -->
<main class="main">
  <div class="topbar">
    <div class="topbar-left">
      <h1>üïê Attendance Management</h1>
      <div class="subtitle">Track daily attendance & manage geofence location rules per branch.</div>
    </div>
    <div class="topbar-right">
      <div class="live-dot"><span class="dot"></span> Live</div>
      <div class="topbar-date" id="dateDisplay"></div>
      <button class="btn-primary" onclick="openManualModal()">‚úèÔ∏è Manual Entry</button>
      <button class="notif-btn">üîî<span class="badge"></span></button>
    </div>
  </div>

  <div class="content">

    <!-- STAT CARDS -->
    <div class="stat-row">
      <div class="sc g"><div class="sc-lbl">Present</div><div class="sc-val" id="s-present">39</div><div class="sc-sub">On time</div><div class="sc-icon">‚úÖ</div></div>
      <div class="sc o"><div class="sc-lbl">Late</div><div class="sc-val" id="s-late">3</div><div class="sc-sub">Past 8:00 AM</div><div class="sc-icon">‚è∞</div></div>
      <div class="sc"><div class="sc-lbl">Absent</div><div class="sc-val" id="s-absent">2</div><div class="sc-sub">No record</div><div class="sc-icon">üö´</div></div>
      <div class="sc b"><div class="sc-lbl">On Leave</div><div class="sc-val" id="s-leave">4</div><div class="sc-sub">Approved</div><div class="sc-icon">üèñÔ∏è</div></div>
      <div class="sc p"><div class="sc-lbl">Rate</div><div class="sc-val" id="s-rate">81%</div><div class="sc-sub">Today's average</div><div class="sc-icon">üìà</div></div>
    </div>

    <!-- MAIN GRID: Table + Geofence -->
    <div class="mg">

      <!-- LEFT: ATTENDANCE TABLE -->
      <div class="card">
        <div class="card-hdr">
          <div class="card-title">üìã Today's Attendance Log</div>
          <div style="display:flex;gap:8px;">
            <button class="btn-outline" onclick="exportCSV()">‚¨á Export</button>
          </div>
        </div>
        <div class="card-body">
          <!-- CALENDAR STRIP -->
          <div class="cal-strip" id="calStrip"></div>

          <!-- TOOLBAR -->
          <div class="att-toolbar">
            <div class="search-wrap">
              <span>üîç</span>
              <input type="text" id="attSearch" placeholder="Search employee..." oninput="renderTable()">
            </div>
            <select class="filter-sel" id="attFilter" onchange="renderTable()">
              <option value="">All Status</option>
              <option value="present">Present</option>
              <option value="late">Late</option>
              <option value="absent">Absent</option>
              <option value="leave">Leave</option>
              <option value="halfday">Half Day</option>
            </select>
          </div>

          <!-- TABLE -->
          <div style="overflow-x:auto;">
            <table class="att-table">
              <thead>
                <tr>
                  <th>Employee</th>
                  <th>Status</th>
                  <th>Time In</th>
                  <th>Time Out</th>
                  <th>Location</th>
                  <th>Distance</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="attTbody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- RIGHT: GEOFENCE PANEL -->
      <div class="card">
        <div class="card-hdr">
          <div class="card-title">üìç Geofence Settings</div>
          <div id="geoStatusBadge" style="font-size:11px;font-weight:600;padding:4px 10px;border-radius:20px;background:rgba(39,174,96,.1);color:var(--success);">‚óè Active</div>
        </div>
        <div class="card-body">
          <div class="geofence-panel">

            <!-- STATUS BAR -->
            <div class="geo-status-bar active" id="geoStatusBar">
              <span class="geo-icon">üõ°Ô∏è</span>
              <div>
                <div style="font-size:13px;font-weight:700;">Geofence is Active</div>
                <div style="font-size:11px;font-weight:400;margin-top:1px;opacity:.8;">Employees must be within allowed radius to clock in.</div>
              </div>
            </div>

            <!-- MAP -->
            <div>
              <div style="font-size:12px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:.6px;margin-bottom:8px;">üìå Branch Location Pin</div>
              <div id="map"></div>
              <div class="map-hint">üìå Click anywhere on the map to set a new branch location pin</div>
            </div>

            <!-- COORDS -->
            <div class="geo-coords">
              <div class="geo-coord-item">
                <div class="lbl">Latitude</div>
                <div class="val" id="geoLat">14.6760¬∞</div>
              </div>
              <div class="geo-coord-item">
                <div class="lbl">Longitude</div>
                <div class="val" id="geoLng">121.0437¬∞</div>
              </div>
              <div class="geo-coord-item" style="grid-column:1/-1">
                <div class="lbl">Address</div>
                <div class="val" style="font-size:12px;" id="geoAddr">North Branch, Quezon City, NCR</div>
              </div>
            </div>

            <!-- RADIUS CONTROL -->
            <div class="radius-control">
              <div class="radius-top">
                <div class="radius-label">üéØ Allowed Radius</div>
                <div class="radius-val"><span id="radiusVal">100</span><span style="font-size:13px;font-weight:500;color:var(--gray)"> m</span></div>
              </div>
              <input type="range" id="radiusSlider" min="50" max="1000" step="50" value="100" oninput="updateRadius(this.value)">
              <div class="radius-presets">
                <button class="rp-btn active" onclick="setRadius(50,this)">50m</button>
                <button class="rp-btn" onclick="setRadius(100,this)">100m</button>
                <button class="rp-btn" onclick="setRadius(200,this)">200m</button>
                <button class="rp-btn" onclick="setRadius(500,this)">500m</button>
                <button class="rp-btn" onclick="setRadius(1000,this)">1 km</button>
              </div>
            </div>

            <!-- TOGGLE + SAVE -->
            <div class="geo-save-row">
              <button class="btn-outline" id="geoToggleBtn" onclick="toggleGeofence()" style="flex:1;">üî¥ Disable Geofence</button>
              <button class="btn-primary" onclick="saveGeofence()" style="flex:1;">üíæ Save Settings</button>
            </div>

          </div>
        </div>
      </div>
    </div><!-- /mg -->

    <!-- BOTTOM ROW -->
    <div class="bottom-row">
      <!-- WEEKLY CHART -->
      <div class="card" style="animation-delay:.35s">
        <div class="card-hdr">
          <div class="card-title">üìä Weekly Attendance Summary</div>
          <span style="font-size:12px;color:var(--gray);">Feb 17‚Äì23, 2026</span>
        </div>
        <div class="card-body">
          <div id="weekChart" style="display:flex;align-items:flex-end;gap:10px;height:110px;"></div>
          <div style="display:flex;gap:16px;margin-top:12px;flex-wrap:wrap;">
            <span style="font-size:12px;color:var(--gray);display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:2px;background:var(--success);display:inline-block;"></span>Present</span>
            <span style="font-size:12px;color:var(--gray);display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:2px;background:var(--warning);display:inline-block;"></span>Late</span>
            <span style="font-size:12px;color:var(--gray);display:flex;align-items:center;gap:5px;"><span style="width:10px;height:10px;border-radius:2px;background:var(--red);display:inline-block;"></span>Absent</span>
          </div>
        </div>
      </div>

      <!-- ACTIVITY LOG -->
      <div class="card" style="animation-delay:.42s">
        <div class="card-hdr">
          <div class="card-title">üìù Recent Activity Log</div>
          <span style="font-size:12px;color:var(--gray);">Today</span>
        </div>
        <div class="card-body" style="padding:14px 22px 20px;">
          <div id="actLog"></div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- ‚ïê‚ïê‚ïê MANUAL ENTRY MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="manualModal">
  <div class="modal">
    <div class="modal-hdr">
      <div class="modal-title">‚úèÔ∏è Manual Attendance Entry</div>
      <button class="modal-close" onclick="closeModal('manualModal')">‚úï</button>
    </div>
    <div class="modal-body">
      <div style="background:rgba(230,126,34,.1);border:1.5px solid rgba(230,126,34,.3);border-radius:10px;padding:12px 14px;margin-bottom:18px;font-size:13px;color:var(--warning);font-weight:500;">
        ‚ö†Ô∏è Manual entries bypass geofence rules. Use only for legitimate cases (e.g., system down, field work). All manual entries are logged.
      </div>
      <div class="form-group">
        <label class="form-label">Employee *</label>
        <select class="form-select" id="m_emp">
          <option value="">Select Employee</option>
          <option value="EMP-001">EMP-001 ‚Äî Maria Reyes</option>
          <option value="EMP-002">EMP-002 ‚Äî Juan Dela Cruz</option>
          <option value="EMP-003">EMP-003 ‚Äî Ana Santos</option>
          <option value="EMP-004">EMP-004 ‚Äî Roberto Lim</option>
          <option value="EMP-005">EMP-005 ‚Äî Carla Torres</option>
          <option value="EMP-006">EMP-006 ‚Äî Ben Mercado</option>
          <option value="EMP-007">EMP-007 ‚Äî Grace Villanueva</option>
          <option value="EMP-008">EMP-008 ‚Äî Mark Espiritu</option>
        </select>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="form-group">
          <label class="form-label">Date *</label>
          <input class="form-input" type="date" id="m_date">
        </div>
        <div class="form-group">
          <label class="form-label">Status *</label>
          <select class="form-select" id="m_status">
            <option value="present">Present</option>
            <option value="late">Late</option>
            <option value="absent">Absent</option>
            <option value="leave">On Leave</option>
            <option value="halfday">Half Day</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Time In</label>
          <input class="form-input" type="time" id="m_timein" value="08:00">
        </div>
        <div class="form-group">
          <label class="form-label">Time Out</label>
          <input class="form-input" type="time" id="m_timeout" value="17:00">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Reason / Remarks *</label>
        <input class="form-input" id="m_reason" placeholder="e.g. Field deployment, system offline, etc.">
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn-outline" onclick="closeModal('manualModal')">Cancel</button>
      <button class="btn-primary" onclick="saveManual()">üíæ Save Entry</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ‚îÄ GLOBALS ‚îÄ‚îÄ‚îÄ
const colors=['#C0392B','#922B21','#2980B9','#27AE60','#E67E22','#8E44AD','#16A085','#D35400'];
let geofenceActive = true;
let branchLat = 14.6760, branchLng = 121.0437, radius = 100;
let map, branchMarker, radiusCircle;

// ‚îÄ‚îÄ‚îÄ ATTENDANCE DATA ‚îÄ‚îÄ‚îÄ
let records = [
  {id:'EMP-001',name:'Maria Reyes',pos:'Cashier',status:'present',timein:'08:01',timeout:'17:02',dist:45,withinZone:true,color:'#C0392B'},
  {id:'EMP-002',name:'Juan Dela Cruz',pos:'Floor Staff',status:'late',timein:'08:47',timeout:'17:05',dist:78,withinZone:true,color:'#922B21'},
  {id:'EMP-003',name:'Ana Santos',pos:'Supervisor',status:'present',timein:'07:55',timeout:'17:00',dist:12,withinZone:true,color:'#2980B9'},
  {id:'EMP-004',name:'Roberto Lim',pos:'Security',status:'absent',timein:'‚Äî',timeout:'‚Äî',dist:null,withinZone:null,color:'#27AE60'},
  {id:'EMP-005',name:'Carla Torres',pos:'Inventory',status:'leave',timein:'‚Äî',timeout:'‚Äî',dist:null,withinZone:null,color:'#E67E22'},
  {id:'EMP-006',name:'Ben Mercado',pos:'Cashier',status:'present',timein:'08:05',timeout:'17:03',dist:95,withinZone:true,color:'#8E44AD'},
  {id:'EMP-007',name:'Grace Villanueva',pos:'HR Assistant',status:'present',timein:'07:59',timeout:'17:01',dist:34,withinZone:true,color:'#16A085'},
  {id:'EMP-008',name:'Mark Espiritu',pos:'Security',status:'present',timein:'22:01',timeout:'06:02',dist:210,withinZone:false,color:'#D35400'},
  {id:'EMP-009',name:'Liza Hernandez',pos:'Floor Staff',status:'halfday',timein:'08:00',timeout:'12:00',dist:56,withinZone:true,color:'#C0392B'},
  {id:'EMP-010',name:'Rico Pascual',pos:'Delivery',status:'present',timein:'08:03',timeout:'17:00',dist:88,withinZone:true,color:'#2980B9'},
];

const weekData=[
  {day:'Mon',present:42,late:3,absent:3},{day:'Tue',present:44,late:2,absent:2},
  {day:'Wed',present:45,late:1,absent:2},{day:'Thu',present:41,late:4,absent:3},
  {day:'Fri',present:39,late:3,absent:2},{day:'Sat',present:30,late:2,absent:5},
  {day:'Sun',present:22,late:1,absent:8},
];

const actLogs=[
  {icon:'‚úÖ',text:'Maria Reyes clocked in',sub:'EMP-001 ¬∑ 08:01 AM ¬∑ 45m from branch',time:'08:01 AM'},
  {icon:'‚è∞',text:'Juan Dela Cruz ‚Äî Late arrival',sub:'EMP-002 ¬∑ 08:47 AM ¬∑ 47 min late',time:'08:47 AM'},
  {icon:'üö´',text:'Mark Espiritu ‚Äî Outside geofence',sub:'EMP-008 ¬∑ 210m from branch ¬∑ Flagged',time:'10:15 PM'},
  {icon:'üìù',text:'Manual entry added',sub:'Carla Torres ¬∑ On Leave approved',time:'07:30 AM'},
  {icon:'üõ°Ô∏è',text:'Geofence radius updated',sub:'Admin changed radius to 100m',time:'Yesterday'},
];

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('en-PH',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  document.getElementById('m_date').value = new Date().toISOString().split('T')[0];
  buildCalStrip();
  renderTable();
  buildWeekChart();
  buildActLog();
  initMap();
  updateStats();
});

// ‚îÄ‚îÄ‚îÄ MAP ‚îÄ‚îÄ‚îÄ
function initMap(){
  map = L.map('map', {zoomControl:true}).setView([branchLat, branchLng], 16);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap'}).addTo(map);

  const pinIcon = L.divIcon({
    html:`<div style="background:var(--red);width:32px;height:32px;border-radius:50% 50% 50% 0;transform:rotate(-45deg);border:3px solid white;box-shadow:0 3px 12px rgba(192,57,43,.5);display:flex;align-items:center;justify-content:center;">
      <span style="transform:rotate(45deg);font-size:14px;">üè¢</span></div>`,
    className:'',iconSize:[32,32],iconAnchor:[16,32]
  });

  branchMarker = L.marker([branchLat, branchLng], {icon: pinIcon, draggable:true}).addTo(map)
    .bindPopup('<b>üè¢ North Branch</b><br>Click map to reposition.').openPopup();

  radiusCircle = L.circle([branchLat, branchLng], {
    radius: radius,
    color: '#C0392B', fillColor:'#E74C3C',
    fillOpacity: 0.12, weight: 2, dashArray:'6 4'
  }).addTo(map);

  // Click map to set new location
  map.on('click', (e) => {
    const {lat, lng} = e.latlng;
    setLocation(lat, lng);
    showToast('info','üìç Branch pin moved! Save settings to apply.');
  });

  // Drag marker to reposition
  branchMarker.on('dragend', (e) => {
    const {lat, lng} = e.target.getLatLng();
    setLocation(lat, lng);
    showToast('info','üìç Branch pin dragged! Save settings to apply.');
  });
}

function setLocation(lat, lng){
  branchLat = lat; branchLng = lng;
  branchMarker.setLatLng([lat, lng]);
  radiusCircle.setLatLng([lat, lng]);
  document.getElementById('geoLat').textContent = lat.toFixed(4)+'¬∞';
  document.getElementById('geoLng').textContent = lng.toFixed(4)+'¬∞';
  document.getElementById('geoAddr').textContent = 'Custom location set ‚Äî save to activate';
}

function updateRadius(val){
  radius = +val;
  document.getElementById('radiusVal').textContent = val >= 1000 ? (val/1000).toFixed(1)+' km' : val;
  document.getElementById('radiusSlider').style.setProperty('--pct', ((val-50)/(1000-50)*100)+'%');
  radiusCircle.setRadius(+val);
  // update preset buttons
  document.querySelectorAll('.rp-btn').forEach(b => {
    const bVal = b.textContent.includes('km') ? 1000 : parseInt(b.textContent);
    b.classList.toggle('active', bVal === +val);
  });
}

function setRadius(val, btn){
  document.getElementById('radiusSlider').value = val;
  updateRadius(val);
}

function toggleGeofence(){
  geofenceActive = !geofenceActive;
  const bar = document.getElementById('geoStatusBar');
  const badge = document.getElementById('geoStatusBadge');
  const btn = document.getElementById('geoToggleBtn');
  if(geofenceActive){
    bar.className='geo-status-bar active';
    bar.innerHTML='<span class="geo-icon">üõ°Ô∏è</span><div><div style="font-size:13px;font-weight:700;">Geofence is Active</div><div style="font-size:11px;font-weight:400;margin-top:1px;opacity:.8;">Employees must be within allowed radius to clock in.</div></div>';
    badge.style.background='rgba(39,174,96,.1)';badge.style.color='var(--success)';badge.textContent='‚óè Active';
    btn.textContent='üî¥ Disable Geofence';
    radiusCircle.setStyle({color:'#C0392B',fillColor:'#E74C3C'});
    showToast('success','üõ°Ô∏è Geofence enabled!');
  } else {
    bar.className='geo-status-bar inactive';
    bar.innerHTML='<span class="geo-icon">‚ö†Ô∏è</span><div><div style="font-size:13px;font-weight:700;">Geofence is Disabled</div><div style="font-size:11px;font-weight:400;margin-top:1px;opacity:.8;">Employees can clock in from any location.</div></div>';
    badge.style.background='rgba(192,57,43,.1)';badge.style.color='var(--red)';badge.textContent='‚óè Inactive';
    btn.textContent='üü¢ Enable Geofence';
    radiusCircle.setStyle({color:'#8B7B78',fillColor:'#8B7B78'});
    showToast('info','‚ö†Ô∏è Geofence disabled. All locations allowed.');
  }
}

function saveGeofence(){
  showToast('success',`‚úÖ Geofence saved! Radius: ${radius}m ¬∑ Lat: ${branchLat.toFixed(4)}¬∞`);
  document.getElementById('geoAddr').textContent = `Branch pinned at ${branchLat.toFixed(4)}¬∞, ${branchLng.toFixed(4)}¬∞`;
  actLogs.unshift({icon:'üõ°Ô∏è',text:'Geofence settings updated',sub:`Radius set to ${radius}m ¬∑ ${new Date().toLocaleTimeString('en-PH',{hour:'2-digit',minute:'2-digit'})}`,time:'Just now'});
  buildActLog();
}

// ‚îÄ‚îÄ‚îÄ CALENDAR STRIP ‚îÄ‚îÄ‚îÄ
function buildCalStrip(){
  const strip = document.getElementById('calStrip');
  const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const today = new Date();
  let html='';
  for(let i=-6;i<=0;i++){
    const d = new Date(today);
    d.setDate(today.getDate()+i);
    const isToday = i===0;
    html += `<div class="cal-day ${isToday?'active':''}" onclick="selectDay(this)">
      <div class="wd">${days[d.getDay()]}</div>
      <div class="dn">${d.getDate()}</div>
      <div class="dot-row">
        <div class="dd" style="background:${isToday?'rgba(255,255,255,.7)':'var(--success)'}"></div>
        <div class="dd" style="background:${isToday?'rgba(255,255,255,.5)':'var(--warning)'}"></div>
      </div>
    </div>`;
  }
  strip.innerHTML = html;
}

function selectDay(el){
  document.querySelectorAll('.cal-day').forEach(d=>d.classList.remove('active'));
  el.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ‚îÄ
function renderTable(){
  const q = document.getElementById('attSearch').value.toLowerCase();
  const f = document.getElementById('attFilter').value;
  const rows = records.filter(r => {
    const m = (r.name+r.id+r.pos).toLowerCase();
    return(!q||m.includes(q))&&(!f||r.status===f);
  });
  const tbody = document.getElementById('attTbody');
  tbody.innerHTML = rows.map(r=>{
    const init = r.name.split(' ').map(n=>n[0]).join('').slice(0,2);
    const sp = statusPill(r.status);
    const distCell = r.dist!==null
      ? `<span class="${r.withinZone?'dist-ok':'dist-fail'}">${r.withinZone?'‚úÖ':'‚õî'} ${r.dist}m</span>`
      : '<span style="color:var(--gray);font-size:12px;">‚Äî</span>';
    const locCell = r.dist!==null
      ? `<span style="font-size:12px;color:var(--gray);">${r.withinZone?'Within zone':'Outside zone'}</span>`
      : '<span style="font-size:12px;color:var(--gray);">‚Äî</span>';
    const rowStyle = (!r.withinZone && r.dist!==null) ? 'background:rgba(192,57,43,.04);' : '';
    return `<tr style="${rowStyle}">
      <td>
        <div class="emp-cell">
          <div class="av" style="background:${r.color}">${init}</div>
          <div><div class="en">${r.name}</div><div class="ei">${r.id} ¬∑ ${r.pos}</div></div>
        </div>
      </td>
      <td>${sp}</td>
      <td class="time-cell" style="color:${r.status==='late'?'var(--warning)':r.timein==='‚Äî'?'var(--gray)':'var(--dark)'}">${r.timein!=='‚Äî'?r.timein+'<span style="font-size:10px;font-weight:400;color:var(--gray);margin-left:2px">AM</span>':'‚Äî'}</td>
      <td class="time-cell" style="color:var(--gray)">${r.timeout!=='‚Äî'?r.timeout:'‚Äî'}</td>
      <td>${locCell}</td>
      <td>${distCell}</td>
      <td>
        <button class="btn-outline" style="padding:5px 10px;font-size:11px;" onclick="editRecord('${r.id}')">‚úèÔ∏è Edit</button>
      </td>
    </tr>`;
  }).join('') || `<tr><td colspan="7" style="text-align:center;padding:32px;color:var(--gray);">No records found.</td></tr>`;
}

function editRecord(id){
  const r = records.find(x=>x.id===id);
  if(!r)return;
  document.getElementById('m_emp').value = r.id;
  document.getElementById('m_status').value = r.status;
  openManualModal();
}

// ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ
function updateStats(){
  document.getElementById('s-present').textContent = records.filter(r=>r.status==='present').length;
  document.getElementById('s-late').textContent = records.filter(r=>r.status==='late').length;
  document.getElementById('s-absent').textContent = records.filter(r=>r.status==='absent').length;
  document.getElementById('s-leave').textContent = records.filter(r=>r.status==='leave').length;
  const total = records.length;
  const ok = records.filter(r=>r.status==='present'||r.status==='late'||r.status==='halfday').length;
  document.getElementById('s-rate').textContent = Math.round(ok/total*100)+'%';
}

// ‚îÄ‚îÄ‚îÄ WEEK CHART ‚îÄ‚îÄ‚îÄ
function buildWeekChart(){
  const maxVal = 48;
  document.getElementById('weekChart').innerHTML = weekData.map(d=>{
    const ph = Math.round(d.present/maxVal*100);
    const lh = Math.round(d.late/maxVal*100);
    const ah = Math.round(d.absent/maxVal*100);
    const isToday = d.day==='Fri';
    return `<div style="display:flex;flex-direction:column;align-items:center;gap:3px;flex:1;">
      <div style="width:100%;display:flex;flex-direction:column;align-items:center;gap:1px;justify-content:flex-end;height:90px;">
        <div title="Absent: ${d.absent}" style="width:70%;height:${ah}%;background:var(--red);border-radius:3px 3px 0 0;opacity:.8;min-height:${d.absent?3:0}px;"></div>
        <div title="Late: ${d.late}" style="width:70%;height:${lh}%;background:var(--warning);opacity:.85;min-height:${d.late?3:0}px;"></div>
        <div title="Present: ${d.present}" style="width:70%;height:${ph}%;background:${isToday?'var(--red)':'var(--success)'};border-radius:0;opacity:${isToday?1:.75};min-height:${d.present?4:0}px;"></div>
      </div>
      <div style="font-size:11px;font-weight:${isToday?'700':'400'};color:${isToday?'var(--red)':'var(--gray)'};">${d.day}</div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ ACT LOG ‚îÄ‚îÄ‚îÄ
function buildActLog(){
  document.getElementById('actLog').innerHTML = actLogs.slice(0,5).map(l=>
    `<div class="log-item">
      <span class="log-icon">${l.icon}</span>
      <div><div class="log-text">${l.text}</div><div class="log-sub">${l.sub}</div></div>
      <div class="log-time">${l.time}</div>
    </div>`
  ).join('');
}

// ‚îÄ‚îÄ‚îÄ MANUAL MODAL ‚îÄ‚îÄ‚îÄ
function openManualModal(){openModal('manualModal');}
function saveManual(){
  const emp = document.getElementById('m_emp').value;
  const st = document.getElementById('m_status').value;
  const reason = document.getElementById('m_reason').value.trim();
  if(!emp){showToast('error','‚ö†Ô∏è Please select an employee.');return;}
  if(!reason){showToast('error','‚ö†Ô∏è Please enter a reason.');return;}
  const r = records.find(x=>x.id===emp);
  if(r){r.status=st;r.timein=document.getElementById('m_timein').value;r.timeout=document.getElementById('m_timeout').value;}
  renderTable(); updateStats();
  actLogs.unshift({icon:'üìù',text:`Manual entry: ${emp}`,sub:`${capFirst(st)} ¬∑ ${reason}`,time:'Just now'});
  buildActLog();
  closeModal('manualModal');
  showToast('success','‚úÖ Attendance entry saved!');
}

// ‚îÄ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ
function exportCSV(){
  const h='ID,Name,Position,Status,TimeIn,TimeOut,Distance,WithinZone';
  const rows = records.map(r=>`${r.id},${r.name},${r.pos},${r.status},${r.timein},${r.timeout},${r.dist??''},${r.withinZone??''}`);
  const csv=[h,...rows].join('\n');
  const a=document.createElement('a');
  a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);
  a.download='attendance.csv';
  a.click();
  showToast('success','üì• Attendance CSV exported!');
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ
function statusPill(s){
  const m={present:'‚úÖ Present',late:'‚è∞ Late',absent:'üö´ Absent',leave:'üèñÔ∏è On Leave',halfday:'‚è± Half Day'};
  return `<span class="pill ${s}"><span class="pill-dot"></span>${m[s]||s}</span>`;
}
function capFirst(s){return s?s[0].toUpperCase()+s.slice(1):'';}
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.modal-overlay').forEach(m=>{m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open');});});
function setActive(el){document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));el.classList.add('active');}
function showToast(type,msg){
  const t=document.getElementById('toast');
  t.className=`toast ${type} show`;t.textContent=msg;
  setTimeout(()=>t.classList.remove('show'),3200);
}

// ‚îÄ‚îÄ‚îÄ RADIUS SLIDER INIT ‚îÄ‚îÄ‚îÄ
window.addEventListener('load',()=>{
  const sl = document.getElementById('radiusSlider');
  sl.style.setProperty('--pct',((sl.value-50)/(1000-50)*100)+'%');
  // set first preset active
  setRadius(50, document.querySelector('.rp-btn'));
});
</script>
</body>
</html>